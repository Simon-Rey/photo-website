
{% assign photos = site.data[include.name] %}
{% assign photoDiv1 = '' | split: '' %}
{% assign photoDiv2 = '' | split: '' %}
{% assign photoDiv3 = '' | split: '' %}
{% assign total_height1 = 0 %}
{% assign total_height2 = 0 %}
{% assign total_height3 = 0 %}

{% for photo in photos %}
  {% if total_height1 <= total_height2 and total_height1 <= total_height3 %}
    {% assign photoDiv1 = photoDiv1 | push: photo %}
    {% assign total_height1 = total_height1 | plus: photo.normalised_height %}
  {% elsif total_height2 <= total_height1 and total_height1 <= total_height3 %}
    {% assign photoDiv2 = photoDiv2 | push: photo %}
    {% assign total_height2 = total_height2 | plus: photo.normalised_height %}
  {%else %}
    {% assign photoDiv3 = photoDiv3 | push: photo %}
    {% assign total_height3 = total_height3 | plus: photo.normalised_height %}
  {% endif %}
{% endfor %}

{% assign allPhotoDivs = '' | split: '' %}
{% assign allPhotoDivs = allPhotoDivs | push: photoDiv1 %}
{% assign allPhotoDivs = allPhotoDivs | push: photoDiv2 %}
{% assign allPhotoDivs = allPhotoDivs | push: photoDiv3 %}

<div class="gallery-wrap">
  {% for photoDiv in allPhotoDivs %}
    <div>
      {% for photo in photoDiv %}
          <img class="photo-thumbnail" src="{{ site.baseurl }}/assets/galleries/{{ photo.src-thumbnail }}"
               {% if photo.alt %} alt="{{ photo.alt }}"{% endif %}
               data-srcfull="{{ site.baseurl }}/assets/galleries/{{ photo.src-full }}">
      {% endfor %}
    </div>
  {% endfor %}
</div>

<div id="modal" class="modal">
  <img class="modal-content" id="modal-image">
  <a class="modal-control modal-prev" id="modal-prev">&#10094;</a>
  <a class="modal-control modal-next" id="modal-next">&#10095;</a>
  <span class="modal-control close">&times;</span>
</div>

<script>
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modal-image');
    const modalControls = document.querySelectorAll('.modal-control');
    const modalPrev = document.getElementById('modal-prev');
    const modalNext = document.getElementById('modal-next');
    const galleryImages = document.querySelectorAll('.photo-thumbnail');
    let currentSlideIndex = 0;
    let slideSrcArray = []; // Array to store image source URLs

    function preloadImages() {
        slideSrcArray.forEach((src) => {
            const img = new Image();
            img.src = src;
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        preloadImages(); // Preload images when the DOM is ready
    });

    galleryImages.forEach((image, index) => {
        image.addEventListener('click', () => {
            showModal();
            modalImg.src = image.dataset.srcfull;
            currentSlideIndex = index;
        });
        slideSrcArray.push(image.dataset.srcfull); // Store src values in the array
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal || e.target.classList.contains('close')) {
            hideModal();
        }
    });

    modalImg.addEventListener('load', function() {
        modalControls.forEach( (c) => {
            c.classList.add('hidden');
        });
    });

    modalPrev.addEventListener('click', () => {
        plusSlides(-1);
    });

    modalNext.addEventListener('click', () => {
        plusSlides(1);
    });

    function showModal() {
        modal.classList.add('visible');
        document.body.style.overflow = 'hidden'; // Hide the scrollbar
    }

    function hideModal() {
        modal.classList.remove('visible');
        document.body.style.overflow = 'auto'; // Restore the scrollbar
        modalPrev.classList.remove('hidden');
        modalNext.classList.remove('hidden');
        modalImg.src = "";
    }

    function plusSlides(n) {
        currentSlideIndex += n;
        if (currentSlideIndex >= slideSrcArray.length) {
            currentSlideIndex = 0;
        }
        if (currentSlideIndex < 0) {
            currentSlideIndex = slideSrcArray.length - 1;
        }
        modalImg.src = slideSrcArray[currentSlideIndex];
    }

    document.addEventListener('keydown', (e) => {
        if (modal.classList.contains('visible')) {
            if (e.key === 'ArrowLeft' || e.keyCode === 37) {
                plusSlides(-1);
            } else if (e.key === 'ArrowRight' || e.keyCode === 39) {
                plusSlides(1);
            } else if (e.key === 'Escape' || e.keyCode === 27) {
                hideModal();
            }
        }
    });
</script>